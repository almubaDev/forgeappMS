{% extends 'app/base.html' %}
{% load static %}

{% block title %}Generador de Contraseñas - Fapass{% endblock %}

{% block content %}
<div class="h-full bg-forge-light overflow-y-auto">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="font-title text-3xl font-bold text-forge-dark mb-2">
                    <i class="fas fa-random text-purple-600 mr-2"></i>
                    Generador de Contraseñas Seguras
                </h1>
                <p class="text-forge-gray">
                    Crea contraseñas fuertes y únicas para proteger tus cuentas
                </p>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                
                <!-- Panel de configuración -->
                <div class="bg-forge-white rounded-xl shadow-md p-8">
                    <h3 class="font-title text-xl font-semibold text-forge-dark mb-6">
                        <i class="fas fa-cogs text-forge-blue mr-2"></i>
                        Configuración
                    </h3>
                    
                    <form method="post" id="password-form" class="space-y-6">
                        {% csrf_token %}
                        
                        <!-- Longitud -->
                        <div>
                            <label for="{{ form.length.id_for_label }}" class="block text-sm font-medium text-forge-dark mb-2">
                                <i class="fas fa-ruler mr-2 text-purple-600"></i>
                                Longitud: <span id="length-value">{{ form.length.value|default:16 }}</span> caracteres
                            </label>
                            {{ form.length }}
                            <div class="flex justify-between text-xs text-forge-gray mt-1">
                                <span>8 (Mínimo)</span>
                                <span>128 (Máximo)</span>
                            </div>
                            {% if form.length.errors %}
                                <div class="mt-1 text-red-600 text-sm">
                                    {% for error in form.length.errors %}
                                        <p><i class="fas fa-exclamation-circle mr-1"></i>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <!-- Opciones de caracteres -->
                        <div class="space-y-4">
                            <h4 class="font-semibold text-forge-dark">Tipos de Caracteres</h4>
                            
                            <!-- Mayúsculas -->
                            <div class="flex items-center">
                                {{ form.include_uppercase }}
                                <label for="{{ form.include_uppercase.id_for_label }}" class="ml-3 text-sm text-forge-dark">
                                    <i class="fas fa-font mr-2 text-blue-600"></i>
                                    Incluir letras mayúsculas (A-Z)
                                </label>
                            </div>
                            
                            <!-- Minúsculas -->
                            <div class="flex items-center">
                                {{ form.include_lowercase }}
                                <label for="{{ form.include_lowercase.id_for_label }}" class="ml-3 text-sm text-forge-dark">
                                    <i class="fas fa-font mr-2 text-green-600"></i>
                                    Incluir letras minúsculas (a-z)
                                </label>
                            </div>
                            
                            <!-- Números -->
                            <div class="flex items-center">
                                {{ form.include_numbers }}
                                <label for="{{ form.include_numbers.id_for_label }}" class="ml-3 text-sm text-forge-dark">
                                    <i class="fas fa-hashtag mr-2 text-forge-orange"></i>
                                    Incluir números (0-9)
                                </label>
                            </div>
                            
                            <!-- Símbolos -->
                            <div class="flex items-center">
                                {{ form.include_symbols }}
                                <label for="{{ form.include_symbols.id_for_label }}" class="ml-3 text-sm text-forge-dark">
                                    <i class="fas fa-at mr-2 text-red-600"></i>
                                    Incluir símbolos (!@#$%^&*)
                                </label>
                            </div>
                            
                            <!-- Excluir ambiguos -->
                            <div class="flex items-center">
                                {{ form.exclude_ambiguous }}
                                <label for="{{ form.exclude_ambiguous.id_for_label }}" class="ml-3 text-sm text-forge-dark">
                                    <i class="fas fa-eye-slash mr-2 text-forge-gray"></i>
                                    Excluir caracteres ambiguos (0, O, l, I)
                                </label>
                            </div>
                        </div>
                        
                        <!-- Errores del formulario -->
                        {% if form.non_field_errors %}
                            <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                                {% for error in form.non_field_errors %}
                                    <p class="text-red-600 text-sm">
                                        <i class="fas fa-exclamation-triangle mr-1"></i>{{ error }}
                                    </p>
                                {% endfor %}
                            </div>
                        {% endif %}
                        
                        <!-- Botones -->
                        <div class="space-y-3">
                            <button type="submit" 
                                    class="w-full bg-purple-600 hover:bg-purple-700 text-forge-white font-medium py-3 px-6 rounded-lg transition-colors duration-200 transform hover:scale-105">
                                <i class="fas fa-random mr-2"></i>
                                Generar Contraseña
                            </button>
                            
                            <button type="button" 
                                    id="generate-ajax"
                                    class="w-full bg-forge-blue hover:bg-forge-blue-dark text-forge-white font-medium py-3 px-6 rounded-lg transition-colors duration-200">
                                <i class="fas fa-bolt mr-2"></i>
                                Generar Rápido (AJAX)
                            </button>
                        </div>
                        
                    </form>
                </div>
                
                <!-- Panel de resultado -->
                <div class="bg-forge-white rounded-xl shadow-md p-8">
                    <h3 class="font-title text-xl font-semibold text-forge-dark mb-6">
                        <i class="fas fa-key text-green-600 mr-2"></i>
                        Contraseña Generada
                    </h3>
                    
                    {% if generated_password %}
                        <!-- Contraseña generada -->
                        <div class="mb-6">
                            <div class="relative">
                                <input type="text" 
                                       id="generated-password" 
                                       value="{{ generated_password }}" 
                                       readonly
                                       class="w-full p-4 bg-forge-light border border-forge-gray rounded-lg font-mono text-lg text-center select-all">
                                <button type="button" 
                                        id="copy-password"
                                        class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-forge-blue hover:bg-forge-blue-dark text-forge-white px-3 py-1 rounded transition-colors">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Análisis de fortaleza -->
                        <div class="space-y-4">
                            <h4 class="font-semibold text-forge-dark">Análisis de Fortaleza</h4>
                            
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div class="text-center p-3 bg-forge-light rounded-lg">
                                    <p class="font-bold text-forge-blue text-xl">{{ generated_password|length }}</p>
                                    <p class="text-forge-gray">Caracteres</p>
                                </div>
                                <div class="text-center p-3 bg-forge-light rounded-lg">
                                    <p class="font-bold text-green-600 text-xl">Alta</p>
                                    <p class="text-forge-gray">Seguridad</p>
                                </div>
                            </div>
                            
                            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                <div class="flex items-center">
                                    <i class="fas fa-shield-alt text-green-600 mr-2"></i>
                                    <span class="text-green-800 font-medium">Contraseña muy segura</span>
                                </div>
                                <p class="text-green-700 text-sm mt-1">
                                    Esta contraseña es prácticamente imposible de descifrar con métodos actuales.
                                </p>
                            </div>
                        </div>
                        
                    {% else %}
                        <!-- Estado inicial -->
                        <div class="text-center py-12">
                            <div class="mb-6">
                                <i class="fas fa-key text-forge-gray text-6xl"></i>
                            </div>
                            <h4 class="font-semibold text-forge-dark mb-2">Lista para generar</h4>
                            <p class="text-forge-gray text-sm">
                                Configura las opciones y haz clic en "Generar Contraseña"
                            </p>
                        </div>
                    {% endif %}
                    
                    <!-- Tips de seguridad -->
                    <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="font-semibold text-blue-800 mb-3">
                            <i class="fas fa-lightbulb mr-1"></i>
                            Consejos de Seguridad
                        </h4>
                        <ul class="text-blue-700 text-sm space-y-1">
                            <li>• Usa una contraseña única para cada cuenta</li>
                            <li>• Nunca compartas tus contraseñas</li>
                            <li>• Usa un gestor de contraseñas confiable</li>
                            <li>• Cambia contraseñas comprometidas inmediatamente</li>
                        </ul>
                    </div>
                </div>
                
            </div>
            
            <!-- Navegación -->
            <div class="mt-8 text-center">
                <a href="{% url 'fapass:dashboard' %}" 
                   class="bg-forge-gray hover:bg-forge-dark text-forge-white font-medium py-3 px-6 rounded-lg transition-colors duration-200">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Volver al Dashboard
                </a>
            </div>
            
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* Slider personalizado */
    input[type="range"] {
        width: 100%;
        height: 6px;
        border-radius: 3px;
        background: #e2e8f0;
        outline: none;
        -webkit-appearance: none;
    }
    
    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #8b5cf6;
        cursor: pointer;
    }
    
    input[type="range"]::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #8b5cf6;
        cursor: pointer;
        border: none;
    }
    
    .select-all {
        user-select: all;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    // Actualizar valor del slider
    const lengthInput = document.getElementById('id_length');
    const lengthValue = document.getElementById('length-value');
    
    lengthInput.addEventListener('input', function() {
        lengthValue.textContent = this.value;
    });
    
    // Generar contraseña con AJAX
    document.getElementById('generate-ajax').addEventListener('click', function() {
        const form = document.getElementById('password-form');
        const formData = new FormData(form);
        
        const data = {
            length: parseInt(formData.get('length')),
            include_uppercase: formData.has('include_uppercase'),
            include_lowercase: formData.has('include_lowercase'),
            include_numbers: formData.has('include_numbers'),
            include_symbols: formData.has('include_symbols'),
            exclude_ambiguous: formData.has('exclude_ambiguous')
        };
        
        fetch('{% url "fapass:generate_password_ajax" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': formData.get('csrfmiddlewaretoken')
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('generated-password').value = data.password;
                // Mostrar el campo de resultado si estaba oculto
                document.querySelector('.password-result').style.display = 'block';
            } else {
                alert('Error: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error al generar contraseña');
        });
    });
    
    // Copiar contraseña al portapapeles
    document.getElementById('copy-password').addEventListener('click', function() {
        const passwordField = document.getElementById('generated-password');
        passwordField.select();
        passwordField.setSelectionRange(0, 99999); // Para móviles
        
        try {
            document.execCommand('copy');
            this.innerHTML = '<i class="fas fa-check"></i>';
            this.classList.remove('bg-forge-blue', 'hover:bg-forge-blue-dark');
            this.classList.add('bg-green-600');
            
            setTimeout(() => {
                this.innerHTML = '<i class="fas fa-copy"></i>';
                this.classList.remove('bg-green-600');
                this.classList.add('bg-forge-blue', 'hover:bg-forge-blue-dark');
            }, 2000);
        } catch (err) {
            alert('No se pudo copiar automáticamente. Selecciona y copia manualmente.');
        }
    });
</script>
{% endblock %}